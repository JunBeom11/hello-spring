<!DOCTYPE html>
<html>
<head>
    <title>Bot Selection</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<select id="bot-select">
    <option value="">Select a bot</option>
    <!-- Options will be populated by JavaScript -->
</select>

<table id="bot-table" border="1">
    <thead>
    <tr>
        <th>User ID</th>
        <th>User Name</th>
        <th>Age</th>
    </tr>
    </thead>
    <tbody>
    <!-- Table rows will be populated by JavaScript -->
    </tbody>
</table>

<script>
    $(document).ready(function() {
        setBotSelectBox();
    });

    function setBotSelectBox() {
        $.ajax({
            url: "/test-tool/bot/load",
            method: "GET",
            success: function(data) {
                var select = $("#bot-select");
                select.empty();
                select.append("<option value=''>Select a bot</option>");
                data.forEach(function(item) {
                    select.append("<option value='" + item.name + "'>" + item.name + " - " + item.version + "</option>");
                });
            },
            error: function(error) {
                console.error("Error fetching data", error);
            }
        });
    }

    $("#bot-select").change(function() {
        var selectedBot = $(this).val();
        if (selectedBot) {
            updateTable(selectedBot);
        } else {
            $("#bot-table tbody").empty(); // Clear table if no bot is selected
        }
    });

    function updateTable(botName) {
        $.ajax({
            url: "/test-tool/bot/load",
            method: "GET",
            success: function(data) {
                var tableBody = $("#bot-table tbody");
                tableBody.empty();
                data.forEach(function(item) {
                    if (item.name === botName) {
                        item.detailMap.userList.forEach(function(user) {
                            tableBody.append(
                                "<tr>" +
                                "<td>" + user.userId + "</td>" +
                                "<td>" + user.userName + "</td>" +
                                "<td>" + user.age + "</td>" +
                                "</tr>"
                            );
                        });
                    }
                });
            },
            error: function(error) {
                console.error("Error fetching data", error);
            }
        });
    }
</script>
</body>
</html>
